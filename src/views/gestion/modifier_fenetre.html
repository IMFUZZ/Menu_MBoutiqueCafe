
<!DOCTYPE html>

<!-- HTML BASE DOCUMENT -->

<HTML lang="fr">
    <HEAD>
        <meta charset="utf-8">
        <title>{{!titre}}</title>
        <meta name="decription" content="Ceci est le 'template' web pour un menu de restaurant.">
        <meta name="auteur" content="Daniel-Junior Dubé et Sarah Laflamme">
        <link rel="shortcut icon" href="/src/tab.ico">
        <link rel="stylesheet" href="/src/affichage.css">
        <link rel="stylesheet" href="/src/modifier_fenetre.css">
        <script type='text/javascript' src='/src/interact-1.2.5.min.js'></script>
        <script type='text/javascript' src='/src/interactApp.js'></script>
        <script type='text/javascript' src='/src/jquery-2.1.4.min.js'></script>
        <script type='text/javascript' src='/src/knockout-3.3.0.js'></script>
        <script type='text/javascript' src='/src/knockout.mapping-latest.js'></script>
        <link rel="stylesheet" type="text/css" href="/src/bootstrap.min.css">
    </HEAD>
        <BODY data-bind="attr: { 'background': choose_background }">
            <div class="interact-container" data-bind="foreach: { data: fenetre.zones, as: 'zone' }">
                <!-- ko if: zone.type() === "ZoneBase" -->
                <div class="zone base" data-bind="style: { 
                    'left' : $data.position_x() + '%', 
                    'top' : $data.position_y() + '%', 
                    'z-index' : $data.position_z(), 
                    width : $data.largeur() + '%', 
                    height : $data.hauteur() + '%'
                }">
                    <!-- ko if: zone.type_style() === "titre" -->
                    <div data-bind="text: contenu, style: {
                        fontFamily : $root.fenetre.theme.titre.police(),
                        fontSize : $root.fenetre.theme.titre.taille() + 'px',
                        color : $root.fenetre.theme.titre.couleur(),
                        background : $root.fenetre.theme.titre.couleur_fond(),
                        opacity : $root.fenetre.theme.titre.opacite_fond(),
                        bold : $root.fenetre.theme.titre.gras(),
                        fontStyle : $root.fenetre.theme.titre.gras(),
                        textDecoration : $root.fenetre.theme.titre.soulignement(),
                        borderColor :  $root.fenetre.theme.titre.bordure.couleur(),
                        borderStyle : $root.fenetre.theme.titre.bordure.style(),
                        borderWidth : $root.fenetre.theme.titre.bordure.taille()
                    }"></div>
                    <!-- /ko -->
                    <!-- ko if: zone.type_style() === "sous_titre" -->
                    <div data-bind="text: contenu, style: {
                        fontFamily : $root.fenetre.theme.sous_titre.police(),
                        fontSize : $root.fenetre.theme.sous_titre.taille() + 'px',
                        color : $root.fenetre.theme.sous_titre.couleur(),
                        background : $root.fenetre.theme.sous_titre.couleur_fond(),
                        opacity : $root.fenetre.theme.sous_titre.opacite_fond(),
                        bold : $root.fenetre.theme.sous_titre.gras(),
                        fontStyle : $root.fenetre.theme.sous_titre.gras(),
                        textDecoration : $root.fenetre.theme.sous_titre.soulignement(),
                        borderColor :  $root.fenetre.theme.sous_titre.bordure.couleur(),
                        borderStyle : $root.fenetre.theme.sous_titre.bordure.style(),
                        borderWidth : $root.fenetre.theme.sous_titre.bordure.taille()
                    }"></div>
                    <!-- /ko -->
                    <!-- ko if: zone.type_style() === "texte" -->
                    <div data-bind="text: contenu, style: {
                        fontFamily : $root.fenetre.theme.texte.police(),
                        fontSize : $root.fenetre.theme.texte.taille() + 'px',
                        color : $root.fenetre.theme.texte.couleur(),
                        background : $root.fenetre.theme.texte.couleur_fond(),
                        opacity : $root.fenetre.theme.texte.opacite_fond(),
                        bold : $root.fenetre.theme.texte.gras(),
                        fontStyle : $root.fenetre.theme.texte.gras(),
                        textDecoration : $root.fenetre.theme.texte.soulignement(),
                        borderColor :  $root.fenetre.theme.texte.bordure.couleur(),
                        borderStyle : $root.fenetre.theme.texte.bordure.style(),
                        borderWidth : $root.fenetre.theme.texte.bordure.taille()
                    }"></div>
                    <!-- /ko -->
                    <span class="delete_zone">X</span>
                </div>
                <!-- /ko -->
                <!-- ko if: zone.type() === "ZoneImage" -->
                <div class="zone media" data-bind="style: { 
                    left : $data.position_x() + '%', 
                    top : $data.position_y() + '%', 
                    'z-index' : $data.position_z(), 
                    width : $data.largeur() + '%', 
                    height : $data.hauteur() + '%', 
                    background : 'rgb(0,0,0)' 
                }">
                    <img data-bind="attr: { 'src': '../src/'+$data.image.chemin_fichier() }">
                    <span class="delete_zone">X</span>
                </div>
                <!-- /ko -->
                <!-- ko if: zone.type() === "ZoneVideo" -->
                <div class="zone media" data-bind="style: { 
                    left : $data.position_x() + '%', 
                    top : $data.position_y() + '%', 
                    'z-index' : $data.position_z(), 
                    width : $data.largeur() + '%', 
                    height : $data.hauteur()  + '%'
                }">
                    <video width="100%" height="100%" muted autoplay loop>
                        <source data-bind="attr: { 
                            'src': $data.video.chemin_fichier() 
                        }" type="video/mp4" />
                        Your browser does not support the video tag.
                    </video>
                    <span class="delete_zone">X</span>
                </div>
                <!-- /ko -->
                <!-- ko if: zone.type() === "ZoneTable" -->
                <div class="zone" data-bind="style: { 
                    left : $data.position_x() + '%', 
                    top : $data.position_y() + '%', 
                    'z-index' : $data.position_z(), 
                    width : $data.largeur() + '%', 
                    height : $data.hauteur() + '%' 
                }">
                    <table data-bind="attr : {
                        fontFamily : $root.fenetre.theme.tableau.police(),
                        fontSize : $root.fenetre.theme.tableau.taille() + 'px',
                        color : $root.fenetre.theme.tableau.couleur(),
                        background : $root.fenetre.theme.tableau.couleur_fond(),
                        opacity : $root.fenetre.theme.tableau.opacite_fond(),
                        bold : $root.fenetre.theme.tableau.gras(),
                        fontStyle : $root.fenetre.theme.tableau.gras(),
                        textDecoration : $root.fenetre.theme.tableau.soulignement(),
                        borderColor :  $root.fenetre.theme.tableau.bordure.couleur(),
                        borderStyle : $root.fenetre.theme.tableau.bordure.style(),
                        borderWidth : $root.fenetre.theme.tableau.bordure.taille() + 'px'
                        }">
                        <tbody data-bind="foreach: { data: $data.lignes, as: 'ligne' }">
                            <tr data-bind="foreach: { data: $data.cellules, as: 'cellule' }, attr : {
                                fontFamily : $root.fenetre.theme.tableau_ligne.police(),
                                fontSize : $root.fenetre.theme.tableau_ligne.taille() + 'px',
                                color : $root.fenetre.theme.tableau_ligne.couleur(),
                                background : $root.fenetre.theme.tableau_ligne.couleur_fond(),
                                opacity : $root.fenetre.theme.tableau_ligne.opacite_fond(),
                                bold : $root.fenetre.theme.tableau_ligne.gras(),
                                fontStyle : $root.fenetre.theme.tableau_ligne.gras(),
                                textDecoration : $root.fenetre.theme.tableau_ligne.soulignement(),
                                borderColor :  $root.fenetre.theme.tableau_ligne.bordure.couleur(),
                                borderStyle : $root.fenetre.theme.tableau_ligne.bordure.style(),
                                borderWidth : $root.fenetre.theme.tableau_ligne.bordure.taille() + 'px'
                            }">
                                <!-- Définir le style selon les attributs json -->
                                <!-- ko if: cellule.type_style() === "tableau_titre" -->
                                <th data-bind="text: $data.contenu, style: { 
                                    fontFamily : $root.fenetre.theme.tableau_titre.police(),
                                    fontSize : $root.fenetre.theme.tableau_titre.taille() + 'px',
                                    color : $root.fenetre.theme.tableau_titre.couleur(),
                                    background : $root.fenetre.theme.tableau_titre.couleur_fond(),
                                    opacity : $root.fenetre.theme.tableau_titre.opacite_fond(),
                                    bold : $root.fenetre.theme.tableau_titre.gras(),
                                    fontStyle : $root.fenetre.theme.tableau_titre.gras(),
                                    textDecoration : $root.fenetre.theme.tableau_titre.soulignement(),
                                    borderColor :  $root.fenetre.theme.tableau_titre.bordure.couleur(),
                                    borderStyle : $root.fenetre.theme.tableau_titre.bordure.style(),
                                    borderWidth : $root.fenetre.theme.tableau_titre.bordure.taille() + 'px'
                                }"></th> 
                                <!-- /ko -->
                                <!-- ko if: cellule.type_style() === "tableau_texte" -->
                                <td data-bind="text: $data.contenu, style: { 
                                    fontFamily : $root.fenetre.theme.tableau_texte.police(),
                                    fontSize : $root.fenetre.theme.tableau_texte.taille() + 'px',
                                    color : $root.fenetre.theme.tableau_texte.couleur(),
                                    background : $root.fenetre.theme.tableau_texte.couleur_fond(),
                                    opacity : $root.fenetre.theme.tableau_texte.opacite_fond(),
                                    bold : $root.fenetre.theme.tableau_texte.gras(),
                                    fontStyle : $root.fenetre.theme.tableau_texte.gras(),
                                    textDecoration : $root.fenetre.theme.tableau_texte.soulignement(),
                                    borderColor :  $root.fenetre.theme.tableau_texte.bordure.couleur(),
                                    borderStyle : $root.fenetre.theme.tableau_texte.bordure.style(),
                                    borderWidth : $root.fenetre.theme.tableau_texte.bordure.taille() + 'px'
                                }"></td> 
                                <!-- /ko -->
  
                            </tr>
                        </tbody>
                    </table>
                    <span class="delete_zone">X</span>
                </div>
                <!-- /ko -->
            </div>
            <span class="toggle_sidebar option_left">»</span>
            <div id="sidebar">
                <span class="toggle_sidebar option_right">«</span>
                <div class="sidebar_row">
                    <h1 data-bind="text: fenetre.nom"></h1>
                </div>
                <div class="sidebar_row form-inline">
                    <label class="sidebar_label">Nom : </label>
                     <input type="text" class="form-control input-sm" data-bind="textInput: $root.fenetre.nom"></input>
                </div>
                <div class="sidebar_row form-inline">
                    <label class="sidebar_label">Thème : </label>
                    <select data-role="none" class="form-control input-sm" data-bind="options: $root.themes, optionsText: 'nom', optionsValue: 'id', value: fenetre.theme.id">
                    </select>
                </div>
                <div class="sidebar_row form-inline">
                    <label class="sidebar_label">Image de fond : </label>
                    <select data-role="none" class="form-control input-sm" data-bind="options: $root.images, optionsText: 'nom', optionsValue: 'id', value: fenetre.image_fond.id">
                    </select>
                </div>
                <div class="sidebar_row form-inline">
                    <label class="sidebar_label">Couleur de fond : </label>
                    <button type="">
                        Choisir
                    </button>
                </div>
                <hr>
                <div class="sidebar_row form-inline text-center">
                    <label class="sidebar_label">Zone sélectionnée : </label>
                    <select data-role="none" class="form-control input-sm" data-bind="options: $root.fenetre.zones, optionsText: 'nom', optionsValue: 'id', value: $root.zone_focus">
                    </select>
                </div>
                <div class="sidebar_row form-inline" id="position">
                    <h2>Position</h2>
                    <div class="sidebar_row form-inline">
                            <label class="sidebar_label">Horizontale : </label>
                            <input type="number" class="form-control input-sm" data-bind="textInput: $root.fenetre.zones()[$root.zone_focus()-1].position_x"></input>
                    </div>
                    <div class="sidebar_row form-inline">
                            <label class="sidebar_label">Verticale : </label>
                            <input type="number" class="form-control input-sm" data-bind="textInput: $root.fenetre.zones()[$root.zone_focus()-1].position_y"></input>
                    </div>
                    <div class="sidebar_row form-inline">
                            <label class="sidebar_label">Profondeur : </label>
                            <input type="number" class="form-control input-sm" data-bind="textInput: $root.fenetre.zones()[$root.zone_focus()-1].position_z"></input>
                    </div>
                </div>
                <div class="sidebar_row">
                    <h2>Dimensions</h2>
                    <div class="sidebar_row form-inline">
                        <label class="sidebar_label">Hauteur : </label>
                        <input type="number" class="form-control input-sm" data-bind="textInput: $root.fenetre.zones()[$root.zone_focus()-1].hauteur"></input>
                    </div>
                    <div class="sidebar_row form-inline">
                        <label class="sidebar_label">Largeur : </label>
                        <input type="number" class="form-control input-sm" data-bind="textInput: $root.fenetre.zones()[$root.zone_focus()-1].largeur"></input>
                    </div>
                </div>
                <div class="sidebar_row badge_button text-center">
                    <a data-bind="attr: { href: '/g/modifier_zone?id='+$root.zone_focus()}">Modifier la zone</a>
                    <a href="#" class="retirer">Supprimer la zone</a> 
                </div>
                <div class="sidebar_row">
                    <button class="custom_button_gris" onclick="appliquer_modifications('{{!titre}}')">Appliquer les modifications</button>
                </div>
            </div>
    </BODY>
</html>

<script type='text/javascript' defer="defer">
    var viewModel = ko.mapping.fromJS({{!data}});
    viewModel.zone_focus = ko.observable();
    viewModel.choose_background = ko.computed(function() {
        if (viewModel.fenetre.image_fond === 'undefined') {
            return viewModel.fenetre.couleur_fond();
        }
        else {
            return '../src/' + viewModel.fenetre.image_fond.chemin_fichier();
        }
    });
    $("body").on("mousedown", ".zone", function() {
        var zone = ko.dataFor(this);
        viewModel.zone_focus(zone.id());
    });
    ko.applyBindings(viewModel);
    function appliquer_modifications(fileName) {
        var unmapped = ko.mapping.toJSON(viewModel);
        console.log(unmapped);
        $.post("/g/" + fileName,
            {
                fileName,
                unmapped
            }
        ).always(function() {
            location.reload();
        });
      }
    function monter_la_fenetre(){
        alert(viewModel.fenetre.zones);
    }
    function ajouter_une_zone(){
        var Zone = function(nom_zone, type_zone){
            this.id = ko.observable(0);
            this.nom = ko.observable(nom_zone);
            this.type = ko.observable(type_zone);
        };
    }
    $("body").on("click", ".toggle_sidebar", function() {
        $("#sidebar").toggleClass("show_sidebar");
    });
</script>