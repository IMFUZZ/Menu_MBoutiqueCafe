<!DOCTYPE html>

<!-- HTML BASE DOCUMENT -->

<HTML>
  <HEAD>
    <title>Système de gestion d'affichage</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="auteurs" content="Daniel-Junior Dubé et Sarah Laflamme">
<!-- 
    <meta content="width=device-width, user-scalable=no" name="viewport">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
 -->
    <link rel="shortcut icon" href="/src/tab.ico">
    <script src="/src/jquery-2.1.4.min.js"></script>
<!-- 
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
     -->
    <script src="/src/bootstrap.js"></script>
    <script type='text/javascript' src='/src/knockout-3.3.0.js'></script>
    <script type='text/javascript' src='/src/knockout.mapping-latest.js'></script>
    <script>
      $(document).ready(function(){
        $("#toggle_sidebar").click(function(){
            $("#content").toggleClass("show_sidebar");
        });
        $("body").on("swiperight",function(){
          $("#content").addClass("show_sidebar");
        });
        $("body").on("swipeleft",function(){
          $("#content").removeClass('show_sidebar');
        });
        window.scrollTo(0, 1);
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/src/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/src/principal.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/src/base_gestion.css">
  </HEAD>
  <BODY>
    <div id="header" class="navbar-fixed-top">
      <div class="logo colonne">
        <img alt="MBoutique Café" src="/src/logo_mboutique.png">
      </div>
      <div class="toggle_sidebar colonne">
        <span id="toggle_sidebar">»</span>
      </div>
      <div class="appliquer_modifications">
        <button type="button" class="b_gris" onclick="appliquer_modifications('{{!titre}}')">Appliquer les modifications</button>
      </div>
    </div>
    
    <div id="sidebar">
      <ul>
        <li>
          <a href="accueil" rel="external">
            <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
            <div class="navigation_element_detail">Accueil</div>
          </a></li>
        <li>
          <a href="periodes" rel="external">
            <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
            <div class="navigation_element_detail">Périodes</div>
          </a>
        </li>
        <li>
          <a href="lister_fenetres" rel="external">
            <span class="glyphicon glyphicon-modal-window" aria-hidden="true"></span>
            <div class="navigation_element_detail">Fenêtres</div>
          </a>
        </li>
        <li>
          <a href="themes" rel="external">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
            <div class="navigation_element_detail">Thèmes</div>
          </a>
        </li>
        <li>
          <a href="medias" rel="external">
            <span class="glyphicon glyphicon-camera" aria-hidden="true"></span>
            <div class="navigation_element_detail">Médias</div>
          </a>
        </li>
        <li>
          <a href="parametres" rel="external">
            <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
            <div class="navigation_element_detail">Paramètres</div>
          </a>
        </li>
        <li>
          <a href="a_propos" rel="external">
            <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
            <div class="navigation_element_detail">À propos</div>
          </a>
        </li>
      </ul>
      <div id="deconnexion">
        <button class="b_gris" type="submit" onclick="location.href = '/g/connexion';" >
          Déconnexion
        </button>
      </div>
    </div>
    
    <div id="content" class="show_sidebar">{{!base}}
    </div>
    
    
    <script type='text/javascript' defer="defer">

      var viewModel = ko.mapping.fromJS({{!data}});
      ko.applyBindings(viewModel);

      $("body").on("click", ".remove", function() {
          //retrieve the context
          var context = ko.contextFor(this),
              id = context.$data.id();
          context.$data.id(-id);
       
          return false;
      });

      $("body").on("click", ".addFenetre", function() {
        var context = ko.contextFor(this),
            nom_fenetre = prompt("Nom de la nouvelle fenêtre : ", "");
        if (nom_fenetre != null) {
            var Fenetre = function(nom_fenetre){
              this.id = ko.observable(0);
              this.nom = ko.observable(nom_fenetre);
              this.theme = ko.observable(context.$root.themes()[0]);
              this.zones = ko.observableArray([]);
            };

            context.$root.fenetres.push(new Fenetre(nom_fenetre));
        }
      });

      function appliquer_modifications(fileName) {
          //var vm = ko.dataFor(document.body);
          var unmapped = ko.mapping.toJSON(viewModel);
          console.log(unmapped);
          $.post("/g/" + fileName,
                  {
                      fileName,
                      unmapped
                  }
              );
      }

      function modifier() {

      }
 
    </script>
  </BODY>
</HTML>