% rebase(path)
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Ajouter une fenêtre</h4>
      </div>
      <div class="modal-body">
        <p>Nom de la nouvelle fenêtre: <input id="nom_fenetre_input" type="text" class="form-control" /></p>
        <!-- <span data-bind="text: nom_nouvelle-fenetre"></span> -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
        <button type="button" class="ajouter_fenetre btn btn-primary" data-dismiss="modal">Ajouter</button>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-lg-12">
      <h1>Liste des fenêtres</h1>
      <!-- <div class="aide">
      	<a href="">Qu'est-ce qu'une fenêtre?</a>
      </div> -->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">+ Ajouter une fenêtre</button>
    </div>
  </div>
  
  <div class="row">
    <div class="panel-group" id="fenetres" role="tablist" aria-multiselectable="true" data-bind="foreach: { data: fenetres, as: 'fenetre' }">
      <!-- ko if: $data.id() > -1 -->
      <div class="panel panel-default">
        <div class="panel-heading" role="tab">
          <h4 class="panel-title">
            <div class="row">
              <div class="col-md-2 col-xs-12">
                <h2>
                  <a role="button" data-toggle="collapse" aria-expanded="true" data-bind="text: $data.nom, attr: { href: '#'+$data.id()}">
                  </a>
                </h2>
              </div>
              <div class="col-md-4  col-xs-12">
                <label>Thème : </label>
                <select class="form-control" data-role="none" data-bind="options: $root.themes, optionsText: 'nom', optionsValue: 'id', value: fenetre.theme.id">
                </select>
              </div>
              <div class="boutons col-md-2 col-md-offset-4 col-xs-12">
                <a href="#" class="retirer">X</a>
                <a class="btn" data-bind="attr: { href: '/g/modifier_fenetre?id='+$data.id()}">Modifier</a>
              </div>
            
            </div>
          </h4>
        </div>
         <div class="panel-collapse collapse" role="tabpanel" data-bind="attr: { id: $data.id()}">
          <ul class="list-group" id="zones" data-bind="foreach: { data: $data.zones, as: 'zone' }">
            <!-- ko if: $data.id() > -1 -->
            <li class="list-group-item">
              <a href="#" class="retirer">X</a>
              <a class="modifier" data-bind="attr: { href: '/g/modifier_zone?id='+$data.id()}">Modifier</a>
              <strong data-bind="text: $data.nom()"></strong> (<span data-bind="text: $data.type()"></span>)
            </li>
            <!-- /ko -->
          </ul>
          <div class="list-group-item">
              <a href="#" class="ajouter_zone">+ Ajouter une zone</a>
              Nouvelle zone
          </div>
        </div>
      </div>
      <!-- /ko -->
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8" defer="defer">
      $("body").on("click", ".retirer", function() {
          var context = ko.contextFor(this),
              id = context.$data.id();
            if (id != 0) {
              context.$data.id(-id);
            } else {
              context.$parent.zones.remove(context.$data);
            }
      });

      $("body").on("click", ".ajouter_fenetre", function() {
        var context = ko.contextFor(this);
            var Fenetre = function(){
              this.id = ko.observable(0);
              this.nom = ko.observable($("#nom_fenetre_input").val());
              this.theme = ko.observable(context.$root.themes()[0]);
              this.zones = ko.observableArray([]);
            };

            context.$root.fenetres.push(new Fenetre());
      });

      $("body").on("click", ".ajouter_zone", function() {
        var context = ko.contextFor(this),
            nom_zone = prompt("Nom de la nouvelle zone : ", ""),
            type_zone = prompt("Type de la zone : ", "ZoneBase");
        if (nom_zone != null) {
          var Zone = function(nom_zone, type_zone){
            this.id = ko.observable(0);
            this.nom = ko.observable(nom_zone);
            this.type = ko.observable(type_zone);
          };

          context.$data.zones.push(new Zone(nom_zone, type_zone));
        }
      });
</script>